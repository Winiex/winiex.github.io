<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 利用 SimpleCV 绘制图片的色深分布直方图 · Bach is coding</title><meta name="description" content="利用 SimpleCV 绘制图片的色深分布直方图 - winiex"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/winiex" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">利用 SimpleCV 绘制图片的色深分布直方图</h1><div class="post-info">Apr 22, 2013</div><div class="post-content"><p>在图像处理的过程中，非常重要的一部分便是对图像所包含的色彩进行分析，从而可以获得该图像在整体层面上的相关特征（Feature）。而在色彩分析过程中，色深分布的分析又是极为基础、重要的一部分。在这篇文章里，我们就一起去了解一下色深以及色彩分布直方图的概念，并进一步研究一下怎样用 Python 来对图像进行色彩取值分布分析，并最终将结果转化为分布直方图（使用了 Python 和 SimpleCV 后，这真的是一个很简单的过程）。</p>
<a id="more"></a>
<h2 id="色深"><a href="#色深" class="headerlink" title="色深"></a>色深</h2><p>在介绍绘制色彩分布直方图之前，我们先回顾下<a href="https://en.wikipedia.org/wiki/Color_depth" target="_blank" rel="external">色深（Color Depth）</a>的概念（我们只粗糙地介绍下，不深究更多的技术细节）。我们已经知道一个常识，那就是，一张最终展示给我们的图片，最终都是由许许多多的<a href="https://en.wikipedia.org/wiki/Pixel" target="_blank" rel="external">像素</a>所组成的二维平面。不同格式、类型的图片是拥有不同类型的像素单元的——对于灰度图片，每个像素只需要表示该位置的灰度等级，所以只需要一个“数据单元”便可以记录下色彩数据；对于基于最常见的 <a href="http://en.wikipedia.org/wiki/RGB_color_space" target="_blank" rel="external">RGB 色彩空间</a>的彩色图片，我们需要在每个单元格里面保存红、绿、蓝三种色彩的色彩信息，最终通过不同的“色彩深度”来完成其它颜色的混合生成，所以对于彩色图片而言，至少需要三个色彩单元来分别记录红、绿、蓝色的“色彩深度”。而无论是对于灰度图片像素色彩的“灰度”，还是彩色图片像素三基础色的“色彩深度”，都存在一个取值的问题——也就是我们的“数据单元”保存的数据所能表示的颜色值的值域（0-1、0-15 还是 0-255，或者更大）——通过取不同的值，表达不同等级的灰度或者不同等级的基础色混合方案，最终会显示不同的色彩。而我们知道，计算机中的数据最终都是以二进制位集合的形式来存储的，这里的图像数据存储单元也是如此——灰度或者基础色“色彩深度”的取值最终都是存储在二进制位集合中的。</p>
<p><strong>保存色彩基本信息的“数据单元”的位数便被称之为色深。</strong></p>
<p>拿我们或多或少听说过的<a href="http://en.wikipedia.org/wiki/Color_depth#True_color_.2824-bit.29" target="_blank" rel="external">“真彩色”（True Colors）</a>色彩存储方案来举例说明：它一共使用了包含 3 个“数据单元”的 24 位来存储色彩信息，而其中用于储存红色、绿色、蓝色的“色彩深度”取值的“数据单元”各占 8 位，那么，“真彩色”色彩存储方案的色深就是 8 位。“真彩色”是现在使用较为广泛的色彩存储方案之一，因为它兼顾了占用空间和显示颜色的广度（也就是<a href="https://en.wikipedia.org/wiki/Gamut" target="_blank" rel="external">色域</a>）——“真彩色”所展示的颜色细腻程度已经让人眼无法感觉出色彩和真实色彩之间的差别（这也是它被成为“真彩色”的原因），而使用的 24 位存储空间也符合现实世界中存储容量的情况。当然，除了“真彩色”存储方案外，还有其它色域更窄但占存储空间小或者色域更广但占存储空间更大的存储方案存在，它们的色深进而也是更“浅”或者更“深”的。</p>
<p>我们可以这样简单地理解：<strong>一张图片的色深代表了它能表达色彩的广度，色深越深，所能表达的色彩广度越大，能够展示的色彩种类越多，但同时所占用的空间越大</strong>。</p>
<h3 id="对于不严谨表述的备注"><a href="#对于不严谨表述的备注" class="headerlink" title="对于不严谨表述的备注"></a>对于不严谨表述的备注</h3><p>我们在这里进行的概念解释极为粗糙、感性，出现了“色彩深度”、“数据单元”这些很不规范的表达。更严谨的介绍请参考各关键概念给出的维基百科链接，并进一步根据索引来查找相关权威专著。</p>
<h2 id="图像色彩分布直方图"><a href="#图像色彩分布直方图" class="headerlink" title="图像色彩分布直方图"></a>图像色彩分布直方图</h2><p>接下来我们再来了解一下<a href="http://en.wikipedia.org/wiki/Image_histogram" target="_blank" rel="external">色彩分布直方图（Image Histogram）</a>。<strong>简而言之，色彩分布直方图是图像数据在相应色深下色彩取值的分布统计直方图</strong>。例如，下图便是一张图片仅打开某个基础色<a href="http://en.wikipedia.org/wiki/Channel_\(digital_image\" target="_blank" rel="external">通道</a>)转化而来的灰度图片的色彩分布直方图（没错，它来自 Photoshop）：</p>
<img src="http://o9fv3ui6e.bkt.clouddn.com/6587a184-3ca5-11e6-b48f-8fe0239dd2a2.png" class="center">
<p>从这张色彩分布直方图中，我们可以看到这个基础色在自己的可取值值域内的分布情况。<strong>这样的基础色取值分布情况是图像很重要的全局特性之一，在图像数据分析、处理上有很重要的应用</strong>。</p>
<h2 id="利用-SimpleCV-获取图像的色彩分布信息"><a href="#利用-SimpleCV-获取图像的色彩分布信息" class="headerlink" title="利用 SimpleCV 获取图像的色彩分布信息"></a>利用 SimpleCV 获取图像的色彩分布信息</h2><p>接下来我们将利用 SimpleCV 获取图像的基础色的色彩分布直方图。对于编写代码而言，这是一个非常简单的过程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SimpleCV <span class="keyword">import</span> *</span><br><span class="line">lena = Image(<span class="string">'lenna'</span>) <span class="comment">#我们使用 Lena 图作演示</span></span><br><span class="line"></span><br><span class="line">(red, green, blue) = lena.splitChannels(<span class="keyword">False</span>) <span class="comment">#获取 Lena 图的三基础色通道</span></span><br><span class="line"></span><br><span class="line">red_histogram = red.histogram(<span class="number">256</span>) <span class="comment">#获取红色通道的分布直方图，参数表示直方图的横轴长度，8 位则有 256 种取值，下同</span></span><br><span class="line">green_histogram = green.histogram(<span class="number">256</span>)</span><br><span class="line">blue_histogram = blue.histogram(<span class="number">256</span>)</span><br></pre></td></tr></table></figure>
<p>是的，就是这么简单。具体步骤的解释在源码中已经用注释的方式给出，不再赘述。接下来，我们要做的工作便是将这些直方图信息使用工具展示出来。我们使用 matplotlib 来完成这个任务。如果你没有安装这个库的话，请运行如下命令来安装它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install matplotlib</span><br></pre></td></tr></table></figure>
<p>我们将使用 matplotlib 的 pyplot 来完成直方图的绘制，并最终保存为图片数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SimpleCV <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> ppt</span><br><span class="line">lena = Image(<span class="string">'lenna'</span>) <span class="comment">#我们使用 Lena 图作演示</span></span><br><span class="line"></span><br><span class="line">(red, green, blue) = lena.splitChannels(<span class="keyword">False</span>) <span class="comment">#获取 Lena 图的三基础色通道</span></span><br><span class="line"></span><br><span class="line">red_histogram = red.histogram(<span class="number">256</span>) <span class="comment">#获取红色通道的分布直方图，参数表示直方图的横轴长度，8 位则有 256 种取值，下同</span></span><br><span class="line">green_histogram = green.histogram(<span class="number">256</span>)</span><br><span class="line">blue_histogram = blue.histogram(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">ppt.bar(range(len(red_histogram)), red_histogram) <span class="comment">#将红色通道的分布数据绘制为直方图并保存为图片，下同</span></span><br><span class="line">ppt.savefig(<span class="string">'red_histogram.png'</span>)</span><br><span class="line"></span><br><span class="line">ppt.bar(range(len(green_histogram)), green_histogram)</span><br><span class="line">ppt.savefig(<span class="string">'green_histogram.png'</span>)</span><br><span class="line"></span><br><span class="line">ppt.bar(range(len(blue_histogram)), blue_histogram)</span><br><span class="line">ppt.savefig(<span class="string">'blue_histogram.png'</span>)</span><br></pre></td></tr></table></figure>
<p>我们最终获得的三个基础色颜色分布直方图如下所示：</p>
<img src="http://o9fv3ui6e.bkt.clouddn.com/d18f758c-3ca5-11e6-8824-5723828f2ebb.png" class="center" width="600">
<p>红色通道颜色分布直方图</p>
<img src="http://o9fv3ui6e.bkt.clouddn.com/f221d966-3ca5-11e6-9886-ebc0c3115cc7.png" class="center" width="600">
<p>绿色通道颜色分布直方图</p>
<img src="http://o9fv3ui6e.bkt.clouddn.com/019d69e6-3ca6-11e6-b9cc-03ee4e957680.png" class="center" width="600">
<p>蓝色通道颜色分布直方图</p>
<p>到了这里，我们所有的工作便已经完成了——我们成功获取了 Lena 图的三个基础色通道的色彩分布直方图。从图中不难看出，横轴代表了相应基础色的某个取值，而纵轴则代表了整个图片中相应基础色的取值为该值的像素的个数。真的不得不赞一下——这个过程在 SimpleCV 和 matplotlib 的帮助下，变得很简单、很优雅了。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>回顾一下我们现在所做的工作，其实也不算复杂——不过是对于一张图片内的像素进行了一次简单统计工作。但是，问题的关键在于，我们理解了这里面所包含的概念、原理没有。另外，基于色彩分布的图像处理方法是非常多的——譬如图片全局的色温调整、偏色图片的修复等——可见，学会以上所说的这些，还远远不够。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2013/04/23/what-should-programmer-do-when-facing-bottleneck/" class="prev">PREV</a><a href="/2013/04/21/tools-about-computer-vision-and-image-processing/" class="next">NEXT</a></div><div data-thread-key="2013/04/22/learning-simplecv-draw-image-histogram/" data-title="利用 SimpleCV 绘制图片的色深分布直方图" data-url="http://bachiscoding.com/2013/04/22/learning-simplecv-draw-image-histogram/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"bachiscoding"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://bachiscoding.com">winiex</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>